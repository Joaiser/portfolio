---
// src/components/ProjectCard.astro

export type ProjectStatus = "Finalizado" | "En desarrollo" | "Beta";

export interface Props {
  title: string;
  description: string;
  tech: string[];
  url?: string;
  iframe?: string;
  video?: string;
  imageUrl?: string;
  repoGithub?: string;
  status?: ProjectStatus;
}

const {
  title,
  description,
  tech,
  url,
  iframe,
  video,
  imageUrl,
  repoGithub,
  status,
} = Astro.props as Props;

const statusClass = {
  Finalizado: "bg-green-100 text-green-800",
  "En desarrollo": "bg-blue-100 text-blue-800",
  Beta: "bg-yellow-100 text-yellow-800",
};

const statusBadgeClass = status
  ? statusClass[status] || "bg-gray-100 text-gray-800"
  : "bg-gray-100 text-gray-800";
---
<div
  class="bg-gray-100 p-6 rounded-xl shadow-md text-left relative dark:bg-gradient-to-b dark:from-purple-950 dark:via-gray-950 dark:to-purple-950"
>
  <!-- Título y estado -->
  <div class="flex items-center justify-between">
    <h3 class="text-xl font-semibold text-purple-700 dark:text-white">{title}</h3>
    {status && (
      <div class={`mt-1 inline-block px-3 py-1 rounded-full text-xs font-semibold ${statusBadgeClass}`}>
        {status}
      </div>
    )}
  </div>

  <!-- Descripción -->
  <p class="text-gray-700 mt-2 dark:text-white">{description}</p>

  <!-- Tecnologías -->
  <div class="mt-4 flex flex-wrap gap-2">
    {tech.map((t) => (
      <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded text-sm dark:bg-purple-950 dark:text-purple-400">{t}</span>
    ))}
  </div>

  <!-- Proyecto online -->
  {url && (
    <a href={url} target="_blank" class="mt-4 inline-block text-purple-600 underline text-sm">
      Ver proyecto online
    </a>
  )}

 {iframe && (
  <div x-data="{ open: false }" class="mt-4">
    <!-- Thumbnail -->
    <div 
      x-show="!open" 
      @click="open = true" 
      class="relative cursor-pointer group"
    >
      <img
        src={`https://img.youtube.com/vi/${iframe.split("/").pop()}/maxresdefault.jpg`}
        class="w-full h-64 object-cover rounded"
        alt={`Thumbnail del proyecto ${title}`}
      />
      <div class="absolute inset-0 bg-black/25 flex items-center justify-center rounded opacity-0 group-hover:opacity-100 transition">
        <span class="text-white font-semibold">Haz clic para reproducir</span>
      </div>
    </div>

    <!-- Iframe ocupa el mismo espacio que el thumbnail/card -->
    <div x-show="open" x-transition class="w-full h-64 mt-0 rounded overflow-hidden">
      <iframe
        src={`https://www.youtube.com/embed/${iframe.split("/").pop()}?autoplay=1`}
        class="w-full h-full"
        style="border: none;"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen
        title={`Video de YouTube de ${title}`}
      />
    </div>
  </div>
)}


  <!-- Video local -->
  {video && (
    <div class="mt-4">
      <video src={video} controls class="w-full rounded shadow" />
    </div>
  )}

  <!-- Imagen -->
  {!url && !iframe && !video && imageUrl && (
    <div class="mt-4">
      <img src={imageUrl} alt={`Captura del proyecto ${title}`} class="w-full rounded shadow" />
    </div>
  )}

  <!-- GitHub -->
  {repoGithub && (
    <a href={repoGithub} target="_blank" class="mt-2 inline-block text-sm text-gray-600 underline dark:text-white">
      Ver código en GitHub
    </a>
  )}

  <!-- Si no hay nada que mostrar -->
  {!url && !iframe && !video && !imageUrl && (
    <p class="text-sm text-gray-500 mt-4 italic dark:text-white">* No hay demo disponible actualmente</p>
  )}
</div>
