---
import ThemeToggle from "../components/ThemeToggle.astro";
import SocialLinks from "../components/SocialLinks.astro";
---

<nav
  x-data="{ open: false }"
  class="fixed top-0 left-0 w-full z-50 px-6 py-4 backdrop-blur-md border-b border-purple-950/50 dark:bg-gray-900/70 dark:border-purple-950/50"
>
  <div
    class="container mx-auto max-w-[1440px] flex items-center justify-between"
  >
    <!-- Logo -->
    <div class="text-3xl font-bold tracking-tight text-purple-700">
      <a href="/">Aitor</a>
    </div>

    <!-- Menú normal en desktop -->
    <div
      class="hidden md:flex items-center gap-8 text-lg font-medium text-purple-700"
    >
      <a
        href="#about"
        class="hover:text-purple-600 hover:scale-105 transition-transform duration-200"
        >Sobre mí</a
      >
      <a
        href="#skills"
        class="hover:text-purple-600 hover:scale-105 transition-transform duration-200"
        >Habilidades</a
      >
      <a
        href="#projects"
        class="hover:text-purple-600 hover:scale-105 transition-transform duration-200"
        >Proyectos</a
      >
      <a
        href="/curriculum/Curriculum-actualizado-27-05-25.pdf"
        target="_blank"
        rel="noopener noreferrer"
        class="hover:text-purple-600 hover:scale-105 transition-transform duration-200"
      >
        Currículum
      </a>
    </div>

    <!-- Botón contacto + social -->
    <div class="hidden md:flex items-center gap-4">
      <SocialLinks />
      <ThemeToggle />
      <a
        id="contact"
        href="mailto:aitor.v@hotmail.com"
        class="relative overflow-hidden border-2 border-purple-600 text-purple-600 dark:border-purple-400 dark:text-purple-400 text-lg font-normal px-6 py-3 rounded-full"
      >
        <span class="absolute"></span>
        <span class="relative z-10">Contactar</span>
      </a>
    </div>

    <!-- Botón hamburguesa mobile -->
    <button
      @click="open = !open"
      class="md:hidden text-purple-700 focus:outline-none"
    >
      <svg
        x-show="!open"
        xmlns="http://www.w3.org/2000/svg"
        class="h-8 w-8"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
      <svg
        x-show="open"
        xmlns="http://www.w3.org/2000/svg"
        class="h-8 w-8"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </div>

  <!-- Menú desplegable en mobile -->
  <div class="absolute top-full left-0 w-full md:hidden">
    <div
      x-show="open"
      x-transition
      class="bg-white dark:bg-gray-900 shadow-md flex flex-col items-center gap-4 p-6"
      x-cloak
    >
      <a href="#about" class="text-purple-700 text-lg font-medium">Sobre mí</a>
      <a href="#projects" class="text-purple-700 text-lg font-medium"
        >Proyectos</a
      >
      <a href="#skills" class="text-purple-700 text-lg font-medium"
        >Habilidades</a
      >
      <a
        href="/curriculum/Curriculum-actualizado-27-05-25.pdf"
        target="_blank"
        rel="noopener noreferrer"
        class="text-purple-700 text-lg font-medium">Currículum</a
      >
      <SocialLinks />
      <ThemeToggle />
      <a
        href="mailto:aitor.v@hotmail.com"
        class="relative overflow-hidden border-2 border-purple-600 text-purple-600 text-lg font-normal px-6 py-3 rounded-full transition-colors duration-300"
      >
        Contactar
        <span
          class="absolute inset-0 bg-purple-600 scale-x-0 scale-y-0 origin-center transition-transform duration-300 z-0"
        ></span>
        <span class="relative z-10">Contactar</span>
      </a>
    </div>
  </div>
</nav>

<script>
  import gsap from "gsap";

  const button = document.getElementById("contact");
  if (button) {
    const bg = button.querySelector("span.absolute") as HTMLElement;

    // quita la transición CSS
    bg.style.transition = "none";

    const clamp = (num: number, min: number, max: number) =>
      Math.min(Math.max(num, min), max);

    button.addEventListener("mouseenter", (e) => {
      const rect = button.getBoundingClientRect();
      const x = clamp(e.clientX - rect.left, 0, rect.width);
      const y = clamp(e.clientY - rect.top, 0, rect.height);
      const maxDim = Math.sqrt(rect.width ** 2 + rect.height ** 2) * 1.2;

      // inicializamos el círculo en 0 en la posición del mouse
      gsap.set(bg, { clipPath: `circle(0px at ${x}px ${y}px)`, opacity: 1 });

      // animamos el círculo hasta cubrir el botón
      gsap.to(bg, {
        clipPath: `circle(${maxDim}px at ${x}px ${y}px)`,
        duration: 0.8,
        ease: "power2.out",
      });
    });

    button.addEventListener("mouseleave", (e) => {
      const rect = button.getBoundingClientRect();
      const x = clamp(e.clientX - rect.left, 0, rect.width);
      const y = clamp(e.clientY - rect.top, 0, rect.height);

      // animamos de vuelta a 0 y ocultamos
      gsap.to(bg, {
        clipPath: `circle(0px at ${x}px ${y}px)`,
        duration: 0.6,
        ease: "power2.in",
        onComplete: () => {
          gsap.set(bg, { opacity: 0 });
        },
      });
    });
  }
</script>

<style>
  #contact span.absolute {
    inset: 0;
    position: absolute;
    background: rgba(147, 51, 234, 0.5); /* fondo sólido */
    border-radius: 9999px;
    pointer-events: none;
    opacity: 0;
    clip-path: circle(0 at 50% 50%);
  }
  .dark #contact span.absolute {
    background: rgba(168, 85, 247, 0.5);
  }
</style>
